<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signal Dashboard - Live Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 30px;
    }
    .logo { font-size: 24px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
    .logo-icon { font-size: 32px; }
    .status { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #4ade80; }
    .status-dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .stat-number { font-size: 36px; font-weight: bold; color: #60a5fa; }
    .stat-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }
    
    .signals-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .signals-title { font-size: 20px; font-weight: 600; }
    .refresh-btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .refresh-btn:hover { background: #2563eb; }
    .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .signals-grid { display: flex; flex-direction: column; gap: 15px; }
    .signal-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      transition: transform 0.2s, border-color 0.2s;
    }
    .signal-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.2);
    }
    .signal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .signal-meta { display: flex; gap: 8px; flex-wrap: wrap; }
    .badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .badge-frustration { background: #fef2f2; color: #dc2626; }
    .badge-churning { background: #fef2f2; color: #b91c1c; }
    .badge-seeking_help { background: #fefce8; color: #ca8a04; }
    .badge-feature_request { background: #eff6ff; color: #2563eb; }
    .badge-positive_feedback { background: #f0fdf4; color: #16a34a; }
    .badge-general { background: #f1f5f9; color: #475569; }
    
    .urgency-critical { background: #dc2626; color: white; }
    .urgency-high { background: #f97316; color: white; }
    .urgency-medium { background: #eab308; color: #1a1a2e; }
    .urgency-low { background: #22c55e; color: white; }
    
    .signal-content { color: #e2e8f0; line-height: 1.6; margin-bottom: 12px; font-size: 15px; }
    .signal-footer { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #64748b; }
    .signal-source { display: flex; align-items: center; gap: 5px; }
    .confidence { color: #94a3b8; }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }
    .empty-icon { font-size: 48px; margin-bottom: 20px; }
    .empty-title { font-size: 20px; color: #94a3b8; margin-bottom: 10px; }
    .empty-text { max-width: 400px; margin: 0 auto; line-height: 1.6; }
    
    .telegram-cta {
      background: linear-gradient(135deg, #0088cc, #00a2e8);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      margin-top: 30px;
    }
    .telegram-cta h3 { margin-bottom: 10px; }
    .telegram-link {
      display: inline-block;
      background: white;
      color: #0088cc;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      margin-top: 15px;
      transition: transform 0.2s;
    }
    .telegram-link:hover { transform: scale(1.05); }
    
    .loading { text-align: center; padding: 40px; color: #64748b; }
    .spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">‚óâ</span>
        <span>Signal Dashboard</span>
      </div>
      <div class="status">
        <span class="status-dot"></span>
        <span>Live ‚Ä¢ AI Classification</span>
      </div>
    </header>
    
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="total-count">0</div>
        <div class="stat-label">Total Signals</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="critical-count">0</div>
        <div class="stat-label">Critical/High</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="frustration-count">0</div>
        <div class="stat-label">Frustration</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="feature-count">0</div>
        <div class="stat-label">Feature Requests</div>
      </div>
    </div>
    
    <div class="signals-header">
      <h2 class="signals-title">Recent Signals</h2>
      <button class="refresh-btn" onclick="fetchSignals()">‚Üª Refresh</button>
    </div>
    
    <div id="signals-container" class="signals-grid">
      <div class="loading">
        <div class="spinner"></div>
        <p style="margin-top: 15px;">Loading signals...</p>
      </div>
    </div>
    
    <div class="telegram-cta">
      <h3>ü§ñ Test it yourself!</h3>
      <p>Send a message to our Telegram bot and watch it appear here in real-time with AI classification.</p>
      <a href="https://t.me/SignalIntellBot" target="_blank" class="telegram-link">
        Message @SignalIntellBot
      </a>
    </div>
  </div>
  
  <script>
    const API_URL = 'http://82.165.15.190:3001';
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
      if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
      return date.toLocaleDateString();
    }
    
    function renderSignal(signal) {
      const intent = signal.classification?.intent_stage || signal.intent_stage || 'general';
      const urgency = signal.classification?.urgency || signal.urgency || 'medium';
      const confidence = signal.classification?.confidence || signal.confidence || 0;
      const reason = signal.classification?.reason || signal.reason || '';
      
      return `
        <div class="signal-card">
          <div class="signal-header">
            <div class="signal-meta">
              <span class="badge badge-${intent}">${intent.replace('_', ' ')}</span>
              <span class="badge urgency-${urgency}">${urgency}</span>
            </div>
            <span class="confidence">${Math.round(confidence * 100)}% confidence</span>
          </div>
          <div class="signal-content">${signal.content || signal.message || 'No content'}</div>
          <div class="signal-footer">
            <span class="signal-source">
              üì± ${signal.source || 'telegram'} ‚Ä¢ ${signal.user_id || 'anonymous'}
            </span>
            <span>${formatDate(signal.createdAt || signal.timestamp)}</span>
          </div>
          ${reason ? `<div style="margin-top: 10px; font-size: 12px; color: #64748b; font-style: italic;">üí° ${reason}</div>` : ''}
        </div>
      `;
    }
    
    async function fetchSignals() {
      const container = document.getElementById('signals-container');
      const btn = document.querySelector('.refresh-btn');
      
      btn.disabled = true;
      btn.textContent = 'Loading...';
      
      try {
        const res = await fetch(`${API_URL}/api/demo/signals`);
        const data = await res.json();
        
        // Update stats
        document.getElementById('total-count').textContent = data.total || data.signals.length;
        
        const signals = data.signals || [];
        const critical = signals.filter(s => 
          (s.classification?.urgency === 'critical' || s.classification?.urgency === 'high' ||
           s.urgency === 'critical' || s.urgency === 'high')
        ).length;
        const frustration = signals.filter(s => 
          (s.classification?.intent_stage === 'frustration' || s.intent_stage === 'frustration')
        ).length;
        const features = signals.filter(s => 
          (s.classification?.intent_stage === 'feature_request' || s.intent_stage === 'feature_request')
        ).length;
        
        document.getElementById('critical-count').textContent = critical;
        document.getElementById('frustration-count').textContent = frustration;
        document.getElementById('feature-count').textContent = features;
        
        if (signals.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üì≠</div>
              <h3 class="empty-title">No signals yet</h3>
              <p class="empty-text">
                Send a message to <a href="https://t.me/SignalIntellBot" style="color: #60a5fa;">@SignalIntellBot</a> 
                on Telegram to see AI-powered signal classification in action!
              </p>
            </div>
          `;
        } else {
          container.innerHTML = signals.map(renderSignal).join('');
        }
      } catch (err) {
        console.error('Error fetching signals:', err);
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <h3 class="empty-title">Connection Error</h3>
            <p class="empty-text">Could not connect to the API. The server might be temporarily unavailable.</p>
          </div>
        `;
      } finally {
        btn.disabled = false;
        btn.textContent = '‚Üª Refresh';
      }
    }
    
    // Initial load
    fetchSignals();
    
    // Auto-refresh every 10 seconds
    setInterval(fetchSignals, 10000);
  </script>
</body>
</html>
